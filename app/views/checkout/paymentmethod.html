<div ng-if="vm.isLoading" layout="row" layout-align="center center">
  <md-progress-circular class="md-accent" md-diameter="100px"></md-progress-circular>
</div>

<form
  name="createForm"
  ng-submit="vm.createOrder(createForm)"
  ng-show="!vm.isLoading"
  class="form-view cart-view checkout-view container container-xxlg"
>

  <h1 class="checkout-title">CHECKOUT</h1>

  <div class="steps-bar" layout="row">
    <a ng-href="/quotations/edit/{{vm.quotation.id}}" flex="25" class="steps-bar-item">
      <span><i class="icon-carro"></i> 1. Mi carrito</span>
    </a>
    <a ng-href="/checkout/client/{{vm.quotation.id}}" flex="25" class="steps-bar-item">
      <span><i class="icon-login"></i> 2. Datos personales</span>
    </a>
    <div flex="25" class="steps-bar-item steps-bar-item-active">
      <span><i class="icon-terminal"></i> 3. Método de pago</span>
    </div>
    <div flex="25" class="steps-bar-item">
      <span><i class="icon-oportunidades"></i> 4. Checkout</span>
    </div>
  </div>

  <div class="checkout-view-inner">
    <h3><strong>1. Elige tu plan de pagos</strong> Los planes de meses sin intereses y pagos fijos solo aplican a tarjetas de crédito.</h3>

    <div class="payment-methods-tabs" layout="row">
      <div ng-click="vm.selectSingle()" class="pay-method-tab" ng-class="{'pay-method-tab-active' : vm.singlePayment }">
        <strong>Una forma de pago</strong>
      </div>
      <!--
      <div ng-click="vm.selectMultiple()" class="pay-method-tab"  ng-class="{'pay-method-tab-active' : vm.multiplePayment }">
        <strong>Multiples formas de pago</strong>
      </div>
      -->
    </div>

    <section layout="row">
      <div flex="75">

        <md-radio-group ng-show="vm.singlePayment && !vm.multiplePayment" ng-model="data.group1">

          <div class="pay-method-wrap" >
            <ng-include
              ng-repeat="paymentGroup in vm.paymentMethods track by $index"
              ng-show="vm.isActiveGroup($index)"
              src="'views/checkout/payment-group.html'">
            </ng-include>

          </div>

        </md-radio-group>

        <div class="second-step-payment">

          <section>
            <h3><strong>2. Ingresa los montos para cada forma de pago</strong></h3>
            <hr />

            <div class="pay-method-wrap pay-method-wrap-v2" >
              <div class="method-block">
                <ul>

                  <li
                    ng-if="vm.activeMethod && (vm.activeMethod.type == 'cash' || vm.activeMethod.type == 'cash-usd' )"
                    layout="row"
                    layout-align="space-between center"
                  >
                    <div flex="30">
                      <strong ng-if="vm.activeMethod.type == 'cash'">Pago Efectivo MXN</strong>
                      <strong ng-if="vm.activeMethod.type == 'cash-usd'">Pago Efectivo USD</strong>
                    </div>
                    <div flex="30" class="method-icon">
                      <i class="icon-cash"></i>
                    </div>
                    <div flex="40" layout="row" layout-align="start end">
                      <div flex="45" class="input-element">
                        <label>CANTIDAD</label>
                        <div class="input-element-inner">
                          <input type="text" ng-model="vm.currentAmmount" required>
                        </div>
                      </div>
                      <a href="#" flex="45" ng-click="vm.applyCashPayment(vm.activeMethod, vm.currentAmmount)" class="action-btn action-btn-save">GUARDAR</a>
                    </div>

                  </li>

                  <li
                    ng-if="vm.activeMethod && (vm.activeMethod.type == 'deposit' || vm.activeMethod.type == 'transfer' || vm.activeMethod.type == 'cheque' || vm.activeMethod.type == 'credit-card' ) "
                    layout="row"
                    layout-align="space-between center"
                  >
                    <div flex="30">
                      <strong>{{vm.activeMethod.label}}</strong>
                    </div>
                    <div flex="30" class="method-icon">
                      <i class="icon-transfer"></i>
                    </div>
                    <div flex="40" layout="row" layout-align="start end">
                      <div flex="45" class="input-element">
                        <label>CANTIDAD</label>
                        <div class="input-element-inner">
                          <input type="text" ng-model="vm.currentAmmount"  required>
                        </div>
                      </div>
                      <a href="#" ng-click="vm.applyTransaction($event, vm.activeMethod, vm.currentAmmount)" flex="45" class="action-btn">APLICAR</a>
                    </div>
                  </li>

                  <li
                    ng-if="vm.activeMethod.terminals && vm.activeMethod.msi"
                    layout="row"
                    layout-align="space-between center"
                  >
                    <div flex="30">
                      <strong>{{vm.activeMethod.label}} Meses</strong>
                     <div class="hl-label"><strong>Sin intereses</strong></div>
                    </div>
                    <div flex="30" class="bank-icons bank-icons-v2">
                      <img src="images/visa.png" alt="">
                      <img src="images/mastercard.png" alt="">
                      <img src="images/amexcard.png" alt="">
                    </div>
                    <div flex="40" layout="row" layout-align="start end">
                      <div flex="45" class="input-element">
                        <label>CANTIDAD</label>
                        <div class="input-element-inner">
                          <input type="text" ng-model="vm.currentAmmount"  required>
                        </div>
                      </div>
                      <a href="#" ng-click="vm.applyTransaction($event, vm.activeMethod, vm.currentAmmount)" flex="45" class="action-btn">APLICAR</a>
                    </div>
                  </li>
                </ul>

                <!--PAYMENTS APPLIED-->
                <div ng-if="vm.isLoadingPayments" layout="row" layout-align="center center">
                  <md-progress-circular class="md-accent" md-diameter="100px"></md-progress-circular>
                </div>
                <h2 ng-if="!vm.isLoadingPayments">
                  Pagos aplicados
                </h2>
                <ul ng-if="!vm.isLoadingPayments">
                  <li ng-repeat="payment in vm.quotation.Payments"  class="applied-payment">

                    <div
                      ng-if="payment.type == 'cash' "
                      layout="row"
                      layout-align="space-between center"
                    >
                      <div flex="30">
                        <strong>Pago efectivo MXN</strong>
                        <p class="pull-left">{{payment.description}}</p>
                      </div>
                      <div class="method-data" flex="60" layout="row">
                        <div flex="33">
                          <p><strong>CANTIDAD</strong></p>
                          <p>{{payment.ammount | currency}}</p>
                        </div>
                      </div>
                      <div flex="10" class="saved-icon-wrap">
                        <i class="icon-checkmark saved-icon"></i>
                      </div>
                    </div>

                    <div
                      ng-if="payment.group == 1 && payment.type != 'cash' && payment.type != 'cash-usd'"
                      layout="row"
                      layout-align="space-between center"
                    >
                      <div flex="30">
                        <strong>Transferencia bancaria</strong>
                        <p class="pull-left">{{payment.description}}</p>
                      </div>
                      <div class="method-data" flex="60" layout="row">
                        <div flex="33">
                          <p><strong>TERMINAL</strong></p>
                          <p>{{payment.terminal}}</p>
                        </div>
                        <div flex="33">
                          <p><strong># AUTORIZACIÓN</strong></p>
                          <p>{{payment.verificationCode}}</p>
                        </div>
                        <div flex="33">
                          <p><strong>CANTIDAD</strong></p>
                          <p>{{payment.ammount | currency}}</p>
                        </div>
                      </div>
                      <div flex="10" class="saved-icon-wrap">
                        <i class="icon-checkmark saved-icon"></i>
                      </div>
                    </div>

                    <div
                      ng-if="payment.group != 1"
                      layout="row"
                      layout-align="space-between center"
                    >
                      <div flex="30">
                        <strong>{{payment.msi}} Meses</strong>
                        <div class="hl-label">
                          <strong>Sin intereses</strong>
                        </div>
                      </div>
                      <div class="method-data" flex="60" layout="row">
                        <div flex="33">
                          <p><strong>TERMINAL</strong></p>
                          <p>{{payment.terminal}}</p>
                        </div>
                        <div flex="33">
                          <p><strong># AUTORIZACIÓN</strong></p>
                          <p>{{payment.verificationCode}}</p>
                        </div>
                        <div flex="33">
                          <p><strong>CANTIDAD</strong></p>
                          <p>{{payment.ammount | currency}}</p>
                        </div>
                      </div>
                      <div flex="10" class="saved-icon-wrap">
                        <i class="icon-checkmark saved-icon"></i>
                      </div>
                    </div>

                  </li>

                </ul>
                <!--END PAYMENTS APPLIED-->


              </div>

            </div>

          </section>


        </div>

      </div>

      <aside flex class="cart-aside">
        <h1 class="cart-title"><i class="icon-carro"><span>{{vm.quotation.totalProducts}}</span></i> <strong>RESUMEN</strong></h1>

        <div class="cart-summary">
          <table>
            <tr>
              <td><strong>Subtotal ({{vm.quotation.totalProducts}}) productos):</strong></td>
              <td><strong>{{vm.quotation.subtotal | currency }}</strong></td>
            </tr>
            <tr>
              <td><strong>Descuento:</strong></td>
              <td><strong>-{{vm.quotation.discount | currency }}</strong></td>
            </tr>
            <tr>
              <td>Costo de envío:</td>
              <td><strong>GRATIS</strong></td>
            </tr>
          </table>
          <hr>
          <div class="cart-totals" layout="row" layout-align="space-between end">
            <div flex="50">
              <h1><strong>TOTAL:</strong></h1>
            </div>
            <div flex="50">
              <h1 class="price-main"><strong>{{vm.quotation.total | currency }}</strong></h1>
            </div>
          </div>
          <hr>
          <table>
            <tr>
              <td><strong>Pagado:</strong></td>
              <td><strong>{{vm.quotation.ammountPaid | currency }}</strong></td>
            </tr>
            <tr>
              <td><strong>Restante:</strong></td>
              <td><strong>{{ (vm.totalPrice - vm.quotation.ammountPaid) | currency }}</strong></td>
            </tr>
          </table>

          <hr>

          <div class="secure-note" layout="row">
            <p flex="60"><strong>Las compras con ACTUAL son 100% seguras.</strong></p>
          </div>

          <input
            type="submit"
            value="CONTINUAR"
            class="cart-view-btn"
            ng-disabled="(vm.quotation.ammountPaid < vm.quotation.total)"
            ng-class="{'cart-view-btn-disabled' : (vm.quotation.ammountPaid < vm.quotation.total) }">

          <p class="cart-summary-note">*Precios en Pesos Mexicanos con impuestos incluidos.</p>

        </div>

      </aside>

    </section>

  </div>
</form>
